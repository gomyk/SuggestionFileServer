html
  head
    meta(charset='utf-8')
    meta(name='viewport', content='width=device-width, initial-scale=1')
    link(rel='stylesheet', href='https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css')
    script(src='https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js')
    script(src='https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js')
    script(type= 'text/javascript', src = '/lib/jquery.js')
    link(rel='stylesheet', href='jjsonviewer.css')
    link(rel='stylesheet', href='/stylesheets/style.css')
    script(src='jjsonviewer.js')

    h1 Script result
    div(sytle="background-color:lightblue" id="fixHeader" )
      a(href='#{link}')
        button.btn.btn-primary(type='button') Download original output json
      ul#navtab.nav.nav-tabs
      div(style='border: 2px solid black' id='border')
        #list.tab-content
  body
    p
    p
    p
      script(type='text/javascript').
        $(document).ready(function() {
          var json = $.getJSON("#{path}", function(data){
              console.log(data.output.length);
              data.output.sort(function (a, b) {
                return a.keyword < b.keyword ? -1 : a.keyword > b.keyword ? 1 : 0;
              });
              if("#{keyword}" == "total") {
                $('#navtab').append("<li class='active'><a data-toggle='tab' href='#total'>Total</a></li>");
                $('#list').append("<div id='total' class='tab-pane fade in active'>")
              } else {
                $('#navtab').append("<li><a data-toggle='tab' href='#total'>Total</a></li>");
                  $('#list').append("<div id='total' class='tab-pane fade'>")
              }



              if(data.output.length == 0){
                $("#fixHeader").append("<h3> Error : Script output is empty</h3>")
                data.output[0] = {Error:'Interest from engine is empty'};
                $("#total").jJsonViewer(data.output);
              } else {
                $("#total").jJsonViewer(data.output);
                var last_index = data.output.length - 1;
                var object = [];
                var index = 0;
                var iskeywordExist = false;
                for(var i = 0;i < data.output.length; ++i){
                      object[index++] = data.output[i];
                      if(i == last_index || data.output[i].keyword != data.output[i+1].keyword) {
                        var id = data.output[i].keyword;
                        if(data.output[i].keyword == "#{keyword}") {
                          $('#navtab').append("<li class='active test'><a data-toggle='tab' href='#"+id +"'>"+data.output[i].keyword +"</a></li>");
                          $('#list').append("<div id='"+ id + "' class='tab-pane fade in active'"+ ">");
                        } else {
                          $('#navtab').append("<li><a data-toggle='tab' href='#"+id +"'>"+data.output[i].keyword +"</a></li>");
                          $('#list').append("<div id='"+ id + "' class='tab-pane fade'"+ ">");
                        }
                        $("#"+id).jJsonViewer(object);
                        index = 0;
                        object = [];
                      }
                    }
              }
            });
          });
